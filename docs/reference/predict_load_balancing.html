<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Predict the load balancing of the next call to <code>make()</code>
for non-staged parallel backends. — predict_load_balancing • drake</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Predict the load balancing of the next call to <code>make()</code>
for non-staged parallel backends. — predict_load_balancing" />

<meta property="og:description" content="Take the past recorded runtimes times from
build_times() and use them to predict how the targets
will be distributed among the available workers in the
next make()." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">drake</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">5.2.1.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/drake.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://ropenscilabs.github.io/drake-manual/faq.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/drake">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Predict the load balancing of the next call to <code>make()</code>
for non-staged parallel backends.</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/drake/blob/master/R/predict_runtime.R'><code>R/predict_runtime.R</code></a></small>
    <div class="hidden name"><code>predict_load_balancing.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Take the past recorded runtimes times from
<code><a href='build_times.html'>build_times()</a></code> and use them to predict how the targets
will be distributed among the available workers in the
next <code><a href='make.html'>make()</a></code>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>predict_load_balancing</span>(<span class='kw'>config</span> <span class='kw'>=</span> <span class='kw pkg'>drake</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/drake/topics/read_drake_config'>read_drake_config</a></span>(), <span class='kw'>targets</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>from_scratch</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>targets_only</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>future_jobs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>digits</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>jobs</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>known_times</span> <span class='kw'>=</span> <span class='fu'>numeric</span>(<span class='fl'>0</span>), <span class='kw'>default_time</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>warn</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>config</th>
      <td><p>option internal runtime parameter list of
<code><a href='make.html'>make</a>(...)</code>,
produced by both <code><a href='make.html'>make()</a></code> and
<code><a href='drake_config.html'>drake_config()</a></code>.</p></td>
    </tr>
    <tr>
      <th>targets</th>
      <td><p>Character vector, names of targets.
Predict the runtime of building these targets
plus dependencies.
Defaults to all targets.</p></td>
    </tr>
    <tr>
      <th>from_scratch</th>
      <td><p>logical, whether to predict a
<code><a href='make.html'>make()</a></code> build from scratch or to
take into account the fact that some targets may be
already up to date and therefore skipped.</p></td>
    </tr>
    <tr>
      <th>targets_only</th>
      <td><p>logical, whether to factor in
just the targets into the calculations or use the
build times for everything, including the imports</p></td>
    </tr>
    <tr>
      <th>future_jobs</th>
      <td><p>deprecated</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>deprecated</p></td>
    </tr>
    <tr>
      <th>jobs</th>
      <td><p>the <code>jobs</code> argument of your next planned
<code><a href='make.html'>make()</a></code>. How many targets to do you plan
to have running simultaneously?</p></td>
    </tr>
    <tr>
      <th>known_times</th>
      <td><p>a named numeric vector with targets/imports
as names and values as hypothetical runtimes in seconds.
Use this argument to overwrite any of the existing build times
or the <code>default_time</code>.</p></td>
    </tr>
    <tr>
      <th>default_time</th>
      <td><p>number of seconds to assume for any
target or import with no recorded runtime (from <code><a href='build_times.html'>build_times()</a></code>)
or anything in <code>known_times</code>.</p></td>
    </tr>
    <tr>
      <th>warn</th>
      <td><p>logical, whether to warn the user about
any targets with no available runtime, either in
<code>known_times</code> or <code><a href='build_times.html'>build_times()</a></code>. The times for these
targets default to <code>default_time</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with (1) the total runtime and (2) a list
of the names of the targets assigned to each worker.
For each worker, targets are listed in the order they are assigned.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The prediction is only a rough approximation.
The algorithm that emulates the workers is not perfect,
and it may turn out to perform poorly in some edge cases.
It assumes you are using one of the backends with persistent workers
(<code>"mclapply"</code>, <code>"parLapply"</code>, or <code>"future_lapply"</code>),
though the transient worker backends <code>"future"</code> and <code>"Makefile"</code>
should be similar. The prediction does not apply
to staged parallelism backends such as
<code><a href='make.html'>make(parallelism = "mclapply_staged")</a></code> or
<code><a href='make.html'>make(parallelism = "parLapply_staged")</a></code>.
The function also assumes
that the overhead of initializing <code><a href='make.html'>make()</a></code> and any workers is
negligible. Use the <code>default_time</code> and <code>known_times</code> arguments
to adjust the assumptions as needed.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='predict_runtime.html'>predict_runtime()</a></code>, <code><a href='build_times.html'>build_times()</a></code>, <code><a href='make.html'>make()</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'><a href='test_with_dir.html'>test_with_dir</a></span>(<span class='st'>"Quarantine side effects."</span>, {
<span class='fu'><a href='load_mtcars_example.html'>load_mtcars_example</a></span>() <span class='co'># Get the code with drake_example("mtcars").</span>
<span class='no'>config</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='make.html'>make</a></span>(<span class='no'>my_plan</span>) <span class='co'># Run the project, build the targets.</span>
<span class='co'># The predictions use the cached build times of the targets,</span>
<span class='co'># but if you expect your target runtimes</span>
<span class='co'># to be different, you can specify them (in seconds).</span>
<span class='no'>known_times</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>5</span>, <span class='fu'>rep</span>(<span class='fl'>7200</span>, <span class='fu'>nrow</span>(<span class='no'>my_plan</span>) - <span class='fl'>1</span>))
<span class='fu'>names</span>(<span class='no'>known_times</span>) <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fu'><a href='file_store.html'>file_store</a></span>(<span class='st'>"report.md"</span>), <span class='no'>my_plan</span>$<span class='no'>target</span>[-<span class='fl'>1</span>])
<span class='no'>known_times</span>
<span class='co'># Predict the runtime</span>
<span class='fu'><a href='predict_runtime.html'>predict_runtime</a></span>(
  <span class='no'>config</span>,
  <span class='kw'>jobs</span> <span class='kw'>=</span> <span class='fl'>7</span>,
  <span class='kw'>from_scratch</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>known_times</span> <span class='kw'>=</span> <span class='no'>known_times</span>
)
<span class='fu'><a href='predict_runtime.html'>predict_runtime</a></span>(
  <span class='no'>config</span>,
  <span class='kw'>jobs</span> <span class='kw'>=</span> <span class='fl'>8</span>,
  <span class='kw'>from_scratch</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>known_times</span> <span class='kw'>=</span> <span class='no'>known_times</span>
)
<span class='co'># Why isn't 8 jobs any better?</span>
<span class='co'># 8 would be a good guess based on the layout of the workflow graph.</span>
<span class='co'># It's because of load balancing.</span>
<span class='co'># Below, each row is a persistent worker.</span>
<span class='no'>balance</span> <span class='kw'>&lt;-</span> <span class='fu'>predict_load_balancing</span>(
  <span class='no'>config</span>,
  <span class='kw'>jobs</span> <span class='kw'>=</span> <span class='fl'>7</span>,
  <span class='kw'>from_scratch</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>known_times</span> <span class='kw'>=</span> <span class='no'>known_times</span>,
  <span class='kw'>targets_only</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
)
<span class='no'>balance</span>
<span class='fu'>max</span>(<span class='no'>balance</span>$<span class='no'>time</span>)
<span class='co'># Each worker gets 2 rate-limiting targets.</span>
<span class='no'>balance</span>$<span class='no'>time</span>
<span class='co'># Even if you add another worker, there will be still be workers</span>
<span class='co'># with two heavy targets.</span>
})
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

